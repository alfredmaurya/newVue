(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[38],{"6e59":function(t,a,e){"use strict";e.r(a);var o=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("q-page",{style:t.isMobile?"":"padding-top: 70px"},[t.isMobile?e("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[e("q-btn",{attrs:{unelevated:"",round:"",color:"primary"},on:{click:function(a){return t.updateDialogState({dialog:"MaintenanceForm",val:!0})}}},[e("q-icon",{attrs:{name:"add"}})],1)],1):e("q-page-sticky",{attrs:{expand:"",position:"top"}},[e("q-toolbar",{staticClass:"bg-white text-dark q-pa-none",attrs:{inset:""}},[e("q-toolbar-title",{staticClass:"text-dark col-auto q-pa-sm"},[t._v("\n        Maintenance\n      ")]),e("q-breadcrumbs",{staticClass:"text-grey col-auto",attrs:{gutter:"sm",separator:"/"}},[e("q-breadcrumbs-el",{attrs:{label:"Dashboard",to:{name:"Homepage"}}}),e("q-breadcrumbs-el",{attrs:{label:"Accommodation Maintenance"}})],1),e("div",{staticClass:"breadcrumb-filters ml-auto flex q-mr-xs"},[e("q-btn",{attrs:{unelevated:"",color:"primary",padding:"5px 15px 5px 10px",size:"11px"},on:{click:function(a){return t.updateDialogState({dialog:"MaintenanceForm",val:!0})}}},[e("q-icon",{staticClass:"q-mr-xs",attrs:{name:"add"}}),t._v("Add\n        ")],1)],1)],1)],1),e("div",{staticClass:"container q-pa-lg"},[e("visi-grid",{ref:"rahiGrid",attrs:{title:"Maintenance","global-search":"",fullscreen:"",data:t.listing,columns:t.columns,loading:t.loading,onRequest:t.onRequest,pagination:t.pagination,rowKey:"id",classes:"table-theme",resetPagination:t.resetPagination,"show-refresh":""},scopedSlots:t._u([{key:"body-cell-location",fn:function(a){return[a.row.location?[e("router-link",{attrs:{to:{name:"Locations",params:{id:a.row.location.id}}}},[t._v("\n            "+t._s(a.row.location.title)+"\n          ")])]:[t._v("\n          "+t._s(t.noDataPlaceHolder)+"\n        ")]]}},{key:"body-cell-park",fn:function(a){return[a.row.park?[t._v("\n          "+t._s(a.row.park.title)+"\n        ")]:[t._v("\n          "+t._s(t.noDataPlaceHolder)+"\n        ")]]}},{key:"body-cell-accommodation",fn:function(a){return[a.row.accommodation?[t._v("\n          "+t._s(a.row.accommodation.title)+"\n        ")]:[t._v("\n          "+t._s(t.noDataPlaceHolder)+"\n        ")]]}},{key:"body-cell-accommodation_type",fn:function(a){return[a.row.accommodation_type?[t._v("\n          "+t._s(a.row.accommodation_type.title)+"\n        ")]:[t._v("\n          "+t._s(t.noDataPlaceHolder)+"\n        ")]]}},{key:"body-cell-Action",fn:function(a){return[e("q-btn-dropdown",{staticClass:"action-dropdown ddropdown",attrs:{padding:"5px",flat:"",icon:"more_vert"}},[e("q-list",{staticClass:"dropdown-sm action-dropdown-box"},[e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return t.updateDialogState({dialog:"MaintenanceForm",val:!0,properties:{id:a.row.id,location_id:a.row.location_id,park_id:a.row.park_id,accommodation_id:a.row.accommodation_id,accommodation_type_id:a.row.accommodation_type_id,start_date:a.row.start_date,end_date:a.row.end_date,notes:a.row.notes},refresh:!0})}}},[e("q-item-section",[e("q-item-label",[e("q-icon",{staticClass:"q-mr-xs",attrs:{name:"edit",size:"15px"}}),t._v("\n                  Edit\n                ")],1)],1)],1),e("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(e){return t.confirmDelete(a.row)}}},[e("q-item-section",[e("q-item-label",[e("q-icon",{staticClass:"q-mr-xs",attrs:{name:"delete",size:"15px"}}),t._v("\n                  Delete\n                ")],1)],1)],1)],1)],1)]}}])})],1),e("Form",{attrs:{parks:t.parks}})],1)},i=[],n=e("ded3"),s=e.n(n),l=(e("4de4"),e("d3b7"),e("e6cf"),e("a79d"),e("99af"),e("2f62")),r=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("visi-dialog",{attrs:{dialog:t.dialog,title:t.title,"show-footer":"",loading:t.loading,beforeShow:t.beforeShow,onHide:t.onHide,onSubmit:t.onSubmit,submitting:t.submitting},scopedSlots:t._u([{key:"ScrollContent",fn:function(){return[e("div",{staticClass:"form q-pa-md"},[e("div",{staticClass:"row q-col-gutter-md"},[e("div",{staticClass:"col-12 col-md-12"},[e("div",{staticClass:"form-field q-pb-none"},[e("div",{staticClass:"alert bg-light-primary text-primary"},[t._v("\n              *Required Fields\n            ")])])]),e("div",{staticClass:"col-12 col-md-6"},[e("div",{staticClass:"form-field q-pb-none"},[e("q-select",{attrs:{outlined:"",label:"Select Location*","lazy-rules":"",options:t.locationOptions,rules:[t.$rules.required()],"option-label":"title","option-value":"id","emit-value":"","map-options":"","use-input":""},on:{filter:t.filterLocation},scopedSlots:t._u([{key:"no-option",fn:function(){return[e("q-item",[e("q-item-section",{staticClass:"text-grey"},[t._v("\n                    No results\n                  ")])],1)]},proxy:!0}]),model:{value:t.detail.location_id,callback:function(a){t.$set(t.detail,"location_id",a)},expression:"detail.location_id"}})],1)]),e("div",{staticClass:"col-12 col-md-6"},[e("div",{staticClass:"form-field q-pb-none"},[e("q-select",{attrs:{outlined:"",label:"Select Park*","lazy-rules":"",options:t.parkOptions,"option-label":"title","option-value":"id","emit-value":"","map-options":"","use-input":""},on:{filter:t.filterPark,input:t.onParkChange},scopedSlots:t._u([{key:"no-option",fn:function(){return[e("q-item",[e("q-item-section",{staticClass:"text-grey"},[t._v("\n                    No results\n                  ")])],1)]},proxy:!0}]),model:{value:t.detail.park_id,callback:function(a){t.$set(t.detail,"park_id",a)},expression:"detail.park_id"}})],1)]),e("div",{staticClass:"col-12 col-md-6"},[e("div",{staticClass:"form-field q-pb-none"},[e("q-select",{attrs:{outlined:"",label:"Select Accommodation*","lazy-rules":"",options:t.accommodation,"option-label":"title","option-value":"id","map-options":"","emit-value":"",loading:t.loadingAccommodation,disabled:t.loadingAccommodation},on:{input:t.onAccommodation},model:{value:t.detail.accommodation_id,callback:function(a){t.$set(t.detail,"accommodation_id",a)},expression:"detail.accommodation_id"}})],1)]),e("div",{staticClass:"col-12 col-md-6"},[e("div",{staticClass:"form-field q-pb-none"},[e("q-select",{attrs:{outlined:"",label:"Select Accommodation Type*","lazy-rules":"",options:t.accommodationType,"option-label":"title","option-value":"id","emit-value":"","map-options":"",loading:t.loadingAccommodationType,disabled:t.loadingAccommodationType},model:{value:t.detail.accommodation_type_id,callback:function(a){t.$set(t.detail,"accommodation_type_id",a)},expression:"detail.accommodation_type_id"}})],1)]),e("div",{staticClass:"col-12 col-md-6"},[e("div",{staticClass:"form-field q-pb-none"},[e("q-input",{attrs:{outlined:"",label:"Start Date* (DD/MM/YYYY)","lazy-rules":"",mask:"##/##/####",rules:[t.$rules.required(),t.$rules.isValidDate(),t.$rules.onlyFutureDates()]},scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[e("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[e("q-date",{attrs:{mask:"DD/MM/YYYY",options:t.futureDatesOption},model:{value:t.detail.start_date,callback:function(a){t.$set(t.detail,"start_date",a)},expression:"detail.start_date"}},[e("div",{staticClass:"row items-center justify-end"},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.detail.start_date,callback:function(a){t.$set(t.detail,"start_date","string"===typeof a?a.trim():a)},expression:"detail.start_date"}})],1)]),e("div",{staticClass:"col-12 col-md-6"},[e("div",{staticClass:"form-field q-pb-none"},[e("q-input",{attrs:{outlined:"",label:"End Date* (DD/MM/YYYY)","lazy-rules":"",mask:"##/##/####",rules:[t.$rules.required(),t.$rules.isValidDate(),t.$rules.onlyFutureDates()]},scopedSlots:t._u([{key:"append",fn:function(){return[e("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[e("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[e("q-date",{attrs:{mask:"DD/MM/YYYY",options:t.futureDatesOption},model:{value:t.detail.end_date,callback:function(a){t.$set(t.detail,"end_date",a)},expression:"detail.end_date"}},[e("div",{staticClass:"row items-center justify-end"},[e("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"Close",color:"primary",flat:""}})],1)])],1)],1)]},proxy:!0}]),model:{value:t.detail.end_date,callback:function(a){t.$set(t.detail,"end_date","string"===typeof a?a.trim():a)},expression:"detail.end_date"}})],1)]),e("div",{staticClass:"col-12 col-md-12"},[e("div",{staticClass:"form-field__area q-pb-none"},[e("q-input",{attrs:{outlined:"",label:"Additional notes","lazy-rules":"",type:"textarea",autogrow:""},model:{value:t.detail.notes,callback:function(a){t.$set(t.detail,"notes","string"===typeof a?a.trim():a)},expression:"detail.notes"}})],1)])])])]},proxy:!0}])})},c=[],d=e("7037"),m=e.n(d);e("e9c4"),e("e260"),e("3ca3"),e("ddb0"),e("cca6"),e("ac1f"),e("1276");function p(){return{dialog:"MaintenanceForm",title:"Add Maintenance",loading:!1,submitting:!1,loadingAccommodation:!1,loadingAccommodationType:!1,locationOptions:[],parkOptions:[],accommodation:[],accommodationType:[],detail:{location_id:"",park_id:"",accommodation_id:"",accommodation_type_id:"",start_date:"",end_date:"",notes:""}}}var u={name:"MaintenanceForm",data:p,props:{parks:{type:Array,default:new Array}},computed:s()({properties:function(){return this.getDialogProperties(this.dialog)}},Object(l["b"])("common",["locations"])),methods:{beforeShow:function(){var t=this;if(this.parkOptions=this.parks,this.locationOptions=this.locations,this.properties.id){this.title="Edit Maintenance";var a=JSON.parse(JSON.stringify(this.properties));a.start_date&&(a.start_date=this.formatDate(a.start_date,"DD/MM/YYYY")),a.end_date&&(a.end_date=this.formatDate(a.end_date,"DD/MM/YYYY")),this.loading=!0;var e=[];e.push(this.onParkChange(a.park_id)),e.push(this.onAccommodation(a.accommodation_id)),Promise.all(e).finally((function(){t.loading=!1})),this.detail=a}},onHide:function(){Object.assign(this.$data,p())},onSubmit:function(){var t=this;this.submitting=!0;var a=s()({},this.detail);if(a.start_date){var e=a.start_date.split("/");a.start_date="".concat(e[2],"-").concat(e[1],"-").concat(e[0])}if(a.end_date){var o=a.end_date.split("/");a.end_date="".concat(o[2],"-").concat(o[1],"-").concat(o[0])}this.$store.dispatch("crud/addUpdate",{body:a,module:"accommodation_maintenance"}).then((function(a){if(a.status)t.updateDialogState({dialog:t.dialog,val:!1}),t.showSuccess(a.message);else if(a.message)if("object"===m()(a.message))for(var e in a.message)t.showError(a.message[e]);else("string"===typeof a.message||a.message instanceof String)&&t.showError(a.message)})).finally((function(){t.submitting=!1}))},filterLocation:function(t,a){var e=this;a(""!==t?function(){var a=t.toLowerCase();e.locationOptions=e.locations.filter((function(t){return t.title.toLowerCase().indexOf(a)>-1}))}:function(){e.locationOptions=e.locations})},filterPark:function(t,a){var e=this,o=this.parks;if(""===t)return a((function(){e.parkOptions=o}));a((function(){var a=t.toLowerCase();e.parkOptions=o.filter((function(t){return t.title.toLowerCase().indexOf(a)>-1}))}))},onParkChange:function(t){var a=this;return this.loadingAccommodation=!0,this.$store.dispatch("crud/getListing",{module:"accommodation",params:{pagination:0,park_id:t}}).then((function(t){t.status&&(a.accommodation=t.data)})).finally((function(){a.loadingAccommodation=!1}))},onAccommodation:function(t){var a=this;return this.loadingAccommodationType=!0,this.$store.dispatch("crud/getListing",{module:"accommodation_type",params:{pagination:0,park_id:this.detail.park_id,accommodation_id:t}}).then((function(t){t.status&&(a.accommodationType=t.data)})).finally((function(){a.loadingAccommodationType=!1}))}}},f=u,g=e("2877"),_=e("ddd8"),b=e("66e5"),v=e("4074"),h=e("27f9"),y=e("0016"),k=e("7cbe"),q=e("52ee"),w=e("9c40"),x=e("7f67"),D=e("eebe"),C=e.n(D),P=Object(g["a"])(f,r,c,!1,null,null,null),S=P.exports;C()(P,"components",{QSelect:_["a"],QItem:b["a"],QItemSection:v["a"],QInput:h["a"],QIcon:y["a"],QPopupProxy:k["a"],QDate:q["a"],QBtn:w["a"]}),C()(P,"directives",{ClosePopup:x["a"]});var A={name:"PageMaintenance",components:{Form:S},computed:s()(s()({},Object(l["b"])("crud",["pagination","getListingByModule"])),{},{listing:function(){return this.getListingByModule(this.module)},localPagination:function(){return this.pagination}}),data:function(){var t=this;return{module:"accommodation_maintenance",loading:!1,refreshOrdersData:!0,columns:[{name:"start_date",label:"Start Date",field:function(a){return t.formatDate(a.start_date)},align:"left",sortable:!0,isVisible:!0,isFixed:!0},{name:"end_date",label:"End Date",field:function(a){return t.formatDate(a.end_date)},align:"left",sortable:!0,isVisible:!0,isFixed:!0},{name:"Action",label:"Action",align:"left",isVisible:!0,isFixed:!0},{name:"location",label:"Location",field:"location",align:"left",isVisible:!0},{name:"park",label:"Park",field:"park",align:"left",isVisible:!0},{name:"accommodation",label:"Accommodation",field:"accommodation",align:"left",isVisible:!0},{name:"accommodation_type",label:"Accommodation Type",field:"accommodation",align:"left",isVisible:!0}],parks:[]}},methods:{onRequest:function(t){var a=this;this.loading=!0;var e={"page[number]":t.pagination.page||1,"page[size]":t.pagination.rowsPerPage||this.localPagination.rowsPerPage,search:t.filter,pagination:1};this.$store.dispatch("crud/getListing",{module:this.module,params:e}).then((function(o){o&&o.status&&(a.$store.commit("crud/SET_LISTING",{module:a.module,listing:o&&o.data&&o.data.data?o.data.data:[],refresh:!(!e||1!==e.Page)||a.refreshOrdersData}),a.$store.commit("crud/UPDATE_PAGINATION",{page:o.data.current_page,rowsPerPage:o.data.per_page,rowsNumber:o.data.total,hasNext:!!o.data.next_page_url,sortBy:t.pagination&&t.pagination.sortBy||null,descending:t.pagination&&t.pagination.descending||!1}))})).finally((function(){a.loading=!1}))},resetPagination:function(){this.$store.commit("crud/UPDATE_PAGINATION",this.defaultPagination)},confirmDelete:function(t){var a=this;console.log(t,"target"),this.visiConfirm('Are you sure you want to delete "'.concat(t.employee.first_name||""," ").concat(t.employee.last_name||"",'" Maintenance')).onOk((function(){a.$store.dispatch("crud/deleteById",{module:a.module,id:t.id}).then((function(t){t.status?(a.$refs.rahiGrid&&a.$refs.rahiGrid.refresh(),a.showSuccess(t.message),a.updateDialogState({dialog:"MaintenanceDetail",val:!1})):t.message&&a.showError(t.message)}))}))}},created:function(){var t=this;this.$store.dispatch("common/getAllLocation"),this.$store.dispatch("crud/getListing",{module:"park",params:{pagination:0}}).then((function(a){a.status&&(t.parks=a.data)}))}},$=A,M=e("9989"),O=e("de5e"),Y=e("65c6"),Q=e("6ac5"),L=e("ead5"),T=e("079eb"),I=e("f20b"),N=e("1c1c"),E=e("0170"),F=Object(g["a"])($,o,i,!1,null,null,null);a["default"]=F.exports;C()(F,"components",{QPage:M["a"],QPageSticky:O["a"],QToolbar:Y["a"],QToolbarTitle:Q["a"],QBreadcrumbs:L["a"],QBreadcrumbsEl:T["a"],QBtn:w["a"],QIcon:y["a"],QBtnDropdown:I["a"],QList:N["a"],QItem:b["a"],QItemSection:v["a"],QItemLabel:E["a"]}),C()(F,"directives",{ClosePopup:x["a"]})}}]);